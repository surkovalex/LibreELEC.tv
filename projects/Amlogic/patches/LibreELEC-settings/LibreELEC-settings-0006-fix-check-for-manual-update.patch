From 77f2038891562129448988907cb82a375efffcc1 Mon Sep 17 00:00:00 2001
From: alex <surkov.alex@gmail.com>
Date: Tue, 6 Jun 2017 15:44:59 +0300
Subject: [PATCH 6/6] fix: check for manual update

---
 src/resources/lib/modules/system.py | 15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/src/resources/lib/modules/system.py b/src/resources/lib/modules/system.py
index cc0afbf..b93a0c3 100644
--- a/src/resources/lib/modules/system.py
+++ b/src/resources/lib/modules/system.py
@@ -729,6 +729,7 @@ class system:
             channel = self.struct['update']['settings']['Channel']['value']
             update_files = []
             build = None
+            dev = '-' + self.oe.DEVICE + '-'
             if not self.update_json is None:
                 if channel != '':
                     if channel in self.update_json:
@@ -736,11 +737,17 @@ class system:
                         if self.oe.ARCHITECTURE in self.update_json[channel]['project']:
                             for i in sorted(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'], key=int, reverse=True):
                                 if shortname is None:
-                                    update_files.append(regex.findall(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'])[0].strip('.tar'))
+                                    pattern = re.compile(dev)
+                                    res = pattern.search(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'], re.IGNORECASE)
+                                    if res is not None:
+                                        update_files.append(regex.findall(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'])[0].strip('.tar'))
                                 else:
-                                    build = self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name']
-                                    if shortname in build:
-                                        break
+                                    pattern = re.compile(dev)
+                                    res = pattern.search(self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name'], re.IGNORECASE)
+                                    if res is not None:
+                                        build = self.update_json[channel]['project'][self.oe.ARCHITECTURE]['releases'][i]['file']['name']
+                                        if shortname in build:
+                                            break
             self.oe.dbg_log('system::get_available_builds', 'exit_function', 0)
             if build is None:
                 return update_files
-- 
1.9.1

